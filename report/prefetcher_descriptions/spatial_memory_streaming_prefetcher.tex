\subsection{Spatial Memory Streaming Prefetcher}
\label{sec:smsPrefetcher}

The Spatial Memory Streaming (SMS) Prefetcher is a spatial locality
prefetcher which tries to exloit the relationship between a memory
page, and a cache line. 

Since a memory page is larger than a cache line, the memory page is
fragmented across several cache lines, and even though the page is in
memory, only parts of it may be in the cache.  When designing
operating systems and database management systems, the system designer
will optimize the design for the memory page size in order to limit
the amount of bandwidth and access to the disk. In order to achieve
this, large and complex data structures will have to be chunked up into
smaller and equal structures that fit into a single memory page.

When performing large scale operations on these data structures, for
example a database search, the program might sit in a loop while it
processes several of these page sized data structures. For instance,
while processing these pages the program might always access a page
header, a B-tree key-pointer and a pointer collection at the end of
the page. By recording the access pattern on a single page the pattern may
be used on multiple pages each time the program accesses a new page
with the same program counter and the same page offset.

\subsubsection{How it works}
SMS uses two different tables in its implementation. The Active
Generation Table (AGT) which is used when recording spatial pattern,
and the Page History Table (PHT) which stores recorded patterns. A
generation is the time over which SMS records access to a spatial
memory region. The spatial memory region is the collection of cache
lines the SMS considers as a larger memory structure and it emulates
the operating system memory page. The memory access that triggers a
generation is referred to as a trigger access and it is the first
access to memory region which is not currently being recorded in the
AGT. The generation ends when one of the accessed cache lines that
have been accessed during the generation is evicted from the cache.
When a generation ends it is transferred from the AGT to the PHT if it
has two or more accesses within the spatial region. In order to make
the implementation easier the AGT is divided into two tables, the
filter table and the accumulation table.  Upon a trigger access the
generation is first inserted into the filter table, when the spatial
region is accessed a second time, it is moved from the filter table to
the accumulation table. All subsequent accesses updates the spatial
pattern in the accumulation table.  An entry in the AGT consist of a
tag, which is the base address of the spatial region, the program
counter and the offset that triggered the generation and a bit pattern
of the cache lines which has been accessed during the generation.
[figure here??]

Upon a trigger access, the PHT is searched for a recorded pattern that
can be used.  The PHT has a tag which is the program counter and
region offset of the trigger access to the generation, and the recorded spatial
pattern. When looking up in the PHT the current program counter and
memory offset is compared to the tag. If it is a match SMS starts to
stream a set of addresses which is the constructed from the spatial
pattern in the PHT and the current memory region access.

{\bf (references, citations)}
Spatial Memory Streaming
Stephen Somogyi, Thomas F. Wenisch,
Anastassia Ailamaki, Babak Falsafi and Andreas Moshovosâ€ 
http://www.eecg.toronto.edu/~moshovos/research/sms.pdf